<!-- 
=========================================================
 Light Bootstrap Dashboard - v2.0.1
=========================================================

 Product Page: https://www.creative-tim.com/product/light-bootstrap-dashboard
 Copyright 2019 Creative Tim (https://www.creative-tim.com)
 Licensed under MIT (https://github.com/creativetimofficial/light-bootstrap-dashboard/blob/master/LICENSE)

 Coded by Creative Tim

=========================================================

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.  -->
 <!DOCTYPE html>

 <html lang="en">
 
 <head>
     <meta charset="utf-8" />
     <link rel="apple-touch-icon" sizes="76x76" href="/userAssets/profile/img/apple-icon.png">
     <link rel="icon" type="image/png" href="/userAssets/profile/img/favicon.ico">
     <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
     <title>Light Bootstrap Dashboard - Free Bootstrap 4 Admin Dashboard by Creative Tim</title>
     <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
         name='viewport' />
     <!--     Fonts and icons     -->
     <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
     <!-- CSS Files -->
     <link href="/userAssets/profile/css/bootstrap.min.css" rel="stylesheet" />
     <link href="/userAssets/profile/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
     <!-- CSS Just for demo purpose, don't include it in your project -->
     <!-- <link href="/userAssets/profile/css/demo.css" rel="stylesheet" /> -->

     <!-- CDN For Sweet Alert -->
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

 </head>
 
 <body>
     <div class="wrapper">
         <div class="sidebar " data-color=orange>
             <!-- data-image="/userAssets/profile/img/sidebar-5.jpg" -->
             <!--
           Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"
   
           Tip 2: you can also add an image using data-image tag
       -->
             <div class="sidebar-wrapper">
                 <div class="logo">
                     <a href="http://www.creative-tim.com" class="simple-text">
 
                     </a>
                 </div>
                 <ul class="nav">
                     <li class="nav-item ">
                         <a class="nav-link active" href="/profile">
                             <i class="nc-icon nc-circle-09"></i>
                             <p>profile</p>
                         </a>
                     </li>
                     <li>
                         <a class="nav-link " href="/editProfile">
                             <i class="nc-icon nc-circle-09"></i>
                             <p>Edit profile</p>
                         </a>
                     </li>
                     <li>
                         <a class="nav-link" href="/orders">
                             <i class="nc-icon nc-circle-09"></i>
                             <p>Orders</p>
                         </a>
                     </li>
                     <li>
                         <a class="nav-link" href="/manageAddress">
                             <i class="nc-icon nc-circle-09"></i>
                             <p>Manage Address</p>
                         </a>
                     </li>
 
 
 
                 </ul>
             </div>
         </div>
         <div class="main-panel">
             <!-- Navbar -->
             <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                 <div class="container-fluid">
                     <a class="navbar-brand" href="#pablo"> Dashboard </a>
                     <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                         aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                         <span class="navbar-toggler-bar burger-lines"></span>
                         <span class="navbar-toggler-bar burger-lines"></span>
                         <span class="navbar-toggler-bar burger-lines"></span>
                     </button>
                     <div class="collapse navbar-collapse justify-content-end" id="navigation">
                         <ul class="nav navbar-nav mr-auto">
                             <li class="nav-item">
                                 <a href="#" class="nav-link" data-toggle="dropdown">
                                     <i class="nc-icon nc-palette"></i>
                                     <span class="d-lg-none">Dashboard</span>
                                 </a>
                             </li>
                             <li class="nav-item">
                                 <a href="#" class="nav-link">
                                     <i class="nc-icon nc-zoom-split"></i>
                                     <span class="d-lg-block">&nbsp;Search</span>
                                 </a>
                             </li>
                         </ul>
                         <ul class="navbar-nav ml-auto">
                             <li class="nav-item">
                                 <a class="nav-link" href="#pablo">
                                     <span class="no-icon">Account</span>
                                 </a>
                             </li>
                             <li class="nav-item dropdown">
                                 <a class="nav-link dropdown-toggle" href="http://example.com"
                                     id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                     aria-expanded="false">
                                     <span class="no-icon">Dropdown</span>
                                 </a>
                                 <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                     <a class="dropdown-item" href="#">Action</a>
                                     <a class="dropdown-item" href="#">Another action</a>
                                     <a class="dropdown-item" href="#">Something</a>
                                     <a class="dropdown-item" href="#">Something else here</a>
                                     <div class="divider"></div>
                                     <a class="dropdown-item" href="#">Separated link</a>
                                 </div>
                             </li>
                             <li class="nav-item">
                                 <a class="nav-link" href="#pablo">
                                     <span class="no-icon">Log out</span>
                                 </a>
                             </li>
                         </ul>
                     </div>
                 </div>
             </nav>
             <!-- End Navbar -->
             <div class="content">
                 <div class="container-fluid ">
                     <div class="row justify-content-center">
                         <div class="col-md-8">
                             <% orders.forEach(order=> { %>
                                <% if(order.items && order.items.length > 0) {%>
                                    <% order.items.forEach(item => { %>
                                 <div class="card ">
                                     <div class="card-header ">
                                         <h4 class="card-title ">
                                             #Order ID : <%= order.orderId %>
                                         </h4>
                                         <hr>
                                        
                                     <div class="card-body bg-light">
                                        <img src="/sharpImages/<%= item.productId.image[0] %>"
                                                            class="img-sm img-thumbnail mb-2" alt="" width="60px"
                                                            height="50px"><br>
                                         <span>Total Price : <%= item.totalPrice %></span><br><br>
                                         <span>Order Date : <%= moment(order.date).format('dddd, MMMM Do YYYY') %></span><br><br>
                                         <span> Delivery Address: <%= order.deliveryAddress %></span><br><br>
                                         <span>Payment Method : <%= order.payment %></span><br><br>
                                         <span>Expected Delivery : <%= order.expectedDelivery %></span><br><br>
                                         
                                         <span >status  : <span style="color: red;"><%= item.orderStatus %></span></span><br><br>
                                     </div>
                                     <!-- <a href=""> <button type="button" class="btn btn-info btn-fill pull-right mr-4 mt-2 mb-2">view Order</button></a> -->
                                     <% if (item.orderStatus === 'placed' || item.orderStatus === 'shipped' || item.orderStatus === 'out_for_delivery') { %>
                                        <a href="">
                                            <button type="button" class="btn btn-danger btn-fill pull-right mr-4 mt-2 mb-2"
                                                    onclick="cancelOrder('<%= order.orderId %>','<%= item._id %>',event)">
                                                Cancel Order
                                            </button>
                                        </a>
                                    <% } %>
                                    

                                    <% if (item.orderStatus === 'delivered') { %>
                                        <!-- Add your new button here -->
                                        <button type="button" class="btn btn-primary btn-fill pull-right mr-4 mt-2 mb-2"
                                                onclick="returnOrder('<%= order.orderId %>','<%= item._id %>',event)">
                                            Return
                                        </button>
                                    <% } %>
                                     </div>
                                 </div> 

                                
                                 <% }) %>
                                 <% }%>
                                 <% }) %>
                         </div>
                     </div>
                 </div>
             </div>
             <!-- <footer class="footer">
                   <div class="container-fluid">
                       <nav>
                           <ul class="footer-menu">
                               <li>
                                   <a href="#">
                                       Home
                                   </a>
                               </li>
                               <li>
                                   <a href="#">
                                       Company
                                   </a>
                               </li>
                               <li>
                                   <a href="#">
                                       Portfolio
                                   </a>
                               </li>
                               <li>
                                   <a href="#">
                                       Blog
                                   </a>
                               </li>
                           </ul>
                           <p class="copyright text-center">
                               Â©
                               <script>
                                   document.write(new Date().getFullYear())
                               </script>
                               <a href="http://www.creative-tim.com">Creative Tim</a>, made with love for a better web
                           </p>
                       </nav>
                   </div>
               </footer> -->
         </div>
     </div>
 </body>
 <!--   Core JS Files   -->
 <script src="/userAssets/profile/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
 <script src="/userAssets/profile/js/core/popper.min.js" type="text/javascript"></script>
 <script src="/userAssets/profile/js/core/bootstrap.min.js" type="text/javascript"></script>
 <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
 <script src="/userAssets/profile/js/plugins/bootstrap-switch.js"></script>
 <!--  Google Maps Plugin    -->
 <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
 <!--  Chartist Plugin  -->
 <script src="/userAssets/profile/js/plugins/chartist.min.js"></script>
 <!--  Notifications Plugin    -->
 <!-- <script src="/userAssets/profile/js/plugins/bootstrap-notify.js"></script> -->
 
 <!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
 <script src="/userAssets/profile/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
 <!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
 <script src="/userAssets/profile/js/demo.js"></script>
 <script type="text/javascript">
     $(document).ready(function () {
         // Javascript method's body can be found /userAssets/profile/js/demos.js
         //demo.initDashboardPageCharts();
 
        //  demo.showNotification();
 
     });
 </script>
 <script>
    //Cancel Order
    function cancelOrder(orderId, itemId, event) {
        event.preventDefault()
        Swal.fire({
            title: 'Are you sure?',
            text: 'Please provide a reason for the cancellation:',
            input: 'text',
            showCancelButton: true,
            confirmButtonText: 'Cancel Order',
            cancelButtonText: 'Close',
            preConfirm: (reason) => {
                return fetch('/cancelOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        orderId: orderId,
                        itemId: itemId,
                        reason: reason,
                    }),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to cancel order');
                    }
                })
                .catch(error => {
                    Swal.showValidationMessage(`Request failed: ${error}`);
                });
            },
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Order Cancellation requested!',
                    icon: 'success',
                    showCancelButton: false,
                    confirmButtonText: 'OK'
                }).then(() => {
                    window.location.href = '/singleOrder?orderId=' + orderId;
                });
            }
        });
    }

    //Return Order
    function returnOrder(orderId, itemId, event) {
        event.preventDefault()
        Swal.fire({
            title: 'Are you sure?',
            text: 'Please provide a reason for the return:',
            input: 'text',
            showCancelButton: true,
            confirmButtonText: 'Return Order',
            cancelButtonText: 'Close',
            preConfirm: (reason) => {
                return fetch('/returnOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        orderId: orderId,
                        itemId: itemId,
                        returnReason: reason,
                    }),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to return order');
                    }
                })
                .catch(error => {
                    Swal.showValidationMessage(`Request failed: ${error}`);
                });
            },
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Order Return requested!',
                    icon: 'success',
                    showCancelButton: false,
                    confirmButtonText: 'OK'
                }).then(() => {
                    window.location.href = '/singleOrder?orderId=' + orderId;
                });
            }
        });
    }
</script>

 </html>